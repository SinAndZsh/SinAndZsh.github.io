<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>思念墙 - 想你 sin</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义颜色，与主页面保持一致 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#8B5CF6',
            secondary: '#EC4899',
            dark: '#1E293B',
            light: '#F8FAFC'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            serif: ['Georgia', 'serif']
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 1px 2px rgba(0,0,0,0.08);
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.1), 0 8px 10px -6px rgba(139, 92, 246, 0.08);
      }
      .bg-blur {
        backdrop-filter: blur(8px);
      }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-light to-purple-50 min-h-screen font-sans text-dark overflow-x-hidden">
  <!-- 导航栏 -->
  <nav class="fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-md shadow-sm transition-all duration-300">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-heart text-primary text-2xl"></i>
        <span class="font-serif text-xl font-semibold text-primary">思念墙</span>
      </div>
      <div class="hidden md:flex items-center space-x-6">
        <a href="index.html#about" class="text-gray-600 hover:text-primary transition-colors">返回主页</a>
        <a href="index.html#photos" class="text-gray-600 hover:text-primary transition-colors">照片</a>
        <a href="index.html#message" class="text-gray-600 hover:text-primary transition-colors">写留言</a>
        <a href="photo-wall.html" class="text-gray-600 hover:text-primary transition-colors">照片墙</a>
      </div>
      <button class="md:hidden text-gray-600 hover:text-primary">
        <i class="fa fa-bars text-xl"></i>
      </button>
    </div>
  </nav>

  <!-- 头部区域 -->
  <header class="pt-24 pb-16 px-4 md:pt-32 md:pb-24 relative overflow-hidden">
    <div class="absolute inset-0 z-0 opacity-10">
      <div class="absolute top-1/3 left-1/4 w-72 h-72 rounded-full bg-primary/20 blur-3xl animate-pulse" style="animation-duration: 6s;"></div>
      <div class="absolute bottom-1/4 right-1/3 w-80 h-80 rounded-full bg-secondary/20 blur-3xl animate-pulse" style="animation-duration: 8s; animation-delay: 2s;"></div>
    </div>
    
    <div class="container mx-auto relative z-10 text-center">
      <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-serif font-bold mb-6 leading-tight text-shadow">
        每一句思念 <span class="text-primary">都被珍藏</span>
      </h1>
      <p class="text-[clamp(1rem,2vw,1.2rem)] text-gray-600 max-w-2xl mx-auto">
        这里记录着所有人对春竹的心意，每一条留言都是真诚的牵挂
      </p>
      
      <!-- 统计卡片 -->
      <div class="flex flex-wrap justify-center gap-6 mt-12">
        <div class="bg-white/90 backdrop-blur-md px-6 py-4 rounded-xl shadow-md">
          <div class="text-3xl font-bold text-primary mb-1" id="messageCount">0</div>
          <div class="text-gray-600 text-sm">留言总数</div>
        </div>
        <div class="bg-white/90 backdrop-blur-md px-6 py-4 rounded-xl shadow-md">
          <div class="text-3xl font-bold text-secondary mb-1" id="peopleCount">0</div>
          <div class="text-gray-600 text-sm">留言人数</div>
        </div>
      </div>
    </div>
  </header>

  <!-- 思念墙主体 -->
  <section class="py-16 px-4 bg-white/80">
    <div class="container mx-auto max-w-6xl">
      <!-- 无留言提示 -->
      <div id="emptyTip" class="text-center py-20">
        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-purple-100 mb-6">
          <i class="fa fa-comment-o text-primary text-3xl"></i>
        </div>
        <h3 class="text-xl font-medium text-gray-700 mb-3">暂无留言</h3>
        <p class="text-gray-500 mb-8">快来成为第一个留下思念的人吧～</p>
        <a href="index.html#message" class="inline-flex items-center gap-2 bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-full shadow-md hover:shadow-lg transition-all">
          写下我的思念
          <i class="fa fa-paper-plane-o"></i>
        </a>
      </div>
      
      <!-- 留言网格 -->
      <div id="messageGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 hidden">
        <!-- 留言卡片会通过JS动态生成 -->
      </div>
    </div>
  </section>

  <!-- 页脚 -->
  <footer class="py-10 px-4 bg-dark text-white">
    <div class="container mx-auto text-center">
      <div class="flex items-center justify-center space-x-2 mb-4">
        <i class="fa fa-heart text-secondary text-xl"></i>
        <span class="font-serif text-xl">想你 sin</span>
      </div>
      <p class="text-gray-400 text-sm">
        思念如sin般循环往复，永不消散 © 2025
      </p>
    </div>
  </footer>

  <!-- 留言渲染脚本 -->
  <script>
    // 1. 从本地存储获取留言数据
    function getMessages() {
      const data = localStorage.getItem('sinMessages');
      return data ? JSON.parse(data) : [];
    }

    // 2. 保存留言到本地存储
    function saveMessage(name, content) {
      const messages = getMessages();
      const newMessage = {
        id: Date.now(), // 唯一ID
        name: name.trim(),
        content: content.trim(),
        time: new Date().toLocaleString('zh-CN', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        })
      };
      messages.push(newMessage);
      localStorage.setItem('sinMessages', JSON.stringify(messages));
      return newMessage;
    }

    // 3. 渲染单条留言卡片
    function renderMessageCard(message) {
      const card = document.createElement('div');
      card.className = 'bg-white rounded-xl shadow-md p-6 card-hover border border-purple-50';
      card.innerHTML = `
        <div class="flex justify-between items-start mb-4">
          <h3 class="font-semibold text-lg text-dark flex items-center">
            <i class="fa fa-user-o text-primary mr-2"></i>
            ${escapeHtml(message.name)}
          </h3>
          <span class="text-gray-400 text-xs">${message.time}</span>
        </div>
        <p class="text-gray-600 leading-relaxed mb-4">
          ${escapeHtml(message.content)}
        </p>
        <div class="flex justify-end">
          <span class="inline-flex items-center text-primary/70 text-sm">
            <i class="fa fa-heart-o mr-1"></i> 思念
          </span>
        </div>
      `;
      return card;
    }

    // 4. 防XSS攻击：转义HTML特殊字符
    function escapeHtml(str) {
      return str.replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
    }

    // 5. 渲染所有留言
    function renderAllMessages() {
      const messages = getMessages();
      const messageGrid = document.getElementById('messageGrid');
      const emptyTip = document.getElementById('emptyTip');
      const messageCount = document.getElementById('messageCount');
      const peopleCount = document.getElementById('peopleCount');

      // 更新统计
      messageCount.textContent = messages.length;
      const names = new Set(messages.map(msg => msg.name));
      peopleCount.textContent = names.size;

      // 显示/隐藏空提示
      if (messages.length === 0) {
        messageGrid.classList.add('hidden');
        emptyTip.classList.remove('hidden');
        return;
      }

      // 清空网格并渲染
      messageGrid.innerHTML = '';
      messageGrid.classList.remove('hidden');
      emptyTip.classList.add('hidden');

      // 倒序渲染（最新的在前面）
      const reversedMessages = [...messages].reverse();
      reversedMessages.forEach(msg => {
        const card = renderMessageCard(msg);
        messageGrid.appendChild(card);
      });
    }

    // 6. 监听URL参数，接收新提交的留言
    function checkNewMessageFromUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      const name = urlParams.get('name');
      const content = urlParams.get('content');

      if (name && content && name.trim() && content.trim()) {
        // 保存留言
        saveMessage(name, content);
        // 清除URL参数（避免刷新重复提交）
        window.history.replaceState({}, document.title, window.location.pathname);
        // 重新渲染
        renderAllMessages();
        // 滚动到最新留言
        setTimeout(() => {
          const firstCard = document.querySelector('#messageGrid > div:first-child');
          if (firstCard) {
            firstCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            // 给新留言添加高亮动画
            firstCard.classList.add('ring-2', 'ring-primary/50');
            setTimeout(() => firstCard.classList.remove('ring-2', 'ring-primary/50'), 2000);
          }
        }, 300);
      }
    }

    // 页面加载时执行
    window.addEventListener('load', () => {
      // 渲染已有留言
      renderAllMessages();
      // 检查是否有新提交的留言
      checkNewMessageFromUrl();

      // 导航栏滚动效果
      window.addEventListener('scroll', () => {
        const nav = document.querySelector('nav');
        if (window.scrollY > 50) {
          nav.classList.add('py-2', 'shadow');
          nav.classList.remove('py-3', 'shadow-sm');
        } else {
          nav.classList.add('py-3', 'shadow-sm');
          nav.classList.remove('py-2', 'shadow');
        }
      });
    });
  </script>
</body>
</html>